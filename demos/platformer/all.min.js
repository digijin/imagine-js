(function(){window.levelparser={parse:function(a){var b,c,d,e,f,g,h,i,j,k;for(e=[],d=a.split("\n"),g=0,h=0,j=d.length;j>h;h++){for(c=d[h],f=0,i=0,k=c.length;k>i;i++)b=c[i],e[f]||e.push([]),e[f].push(parseInt(b)),f++;g++}return e}}}).call(this),level1=levelparser.parse("                                                                             \n      4        2  1  1111    1   1    11                                     \n               1111          11 11 1 1  1                                    \n                             1 1 1    11        111                          \n             11     2        1   1 1   1                       3         6   \n        5           11  5    1   1 1  1      1       1    5                  \n  1                       1                 11 2 2 2 11                      "),function(){window.Block=function(){return{name:"block",life:1,indestructable:!1,damage:function(){return this.life-=1,this.life<=0?this.die():void 0},die:function(){var a,b,c,d;for(a=this.getComponent("element"),Imagine.destroy(this),c=d=1;4>=d;c=++d)b=$('<div class="brickFrags"></div>'),$("#wrapper").append(b),b.css("left",$(a).css("left")),b.css("top",$(a).css("top")),b=Imagine(b[0]).addComponent(Dying()).getComponent("dying"),b.dirH=4*(Math.random()-.5),b.dirV=4*(Math.random()-.5);return $(a).remove()}}}}.call(this),function(){window.Castle=function(){return{name:"castle",start:function(){},update:function(){}}}}.call(this),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};window.Character=function(){return{name:"character",speed:200,dirV:0,dirH:0,jumpPower:4,walkSpeed:2,gravity:9,maxFallSpeed:4,coll:void 0,sideColl:void 0,faceLeft:function(){return $(this.element).addClass("flipH")},faceRight:function(){return $(this.element).removeClass("flipH")},start:function(){this.element=this.getComponent("element"),this.collider=this.getComponent("collider")},update:function(){var b,c;return this.dirV+=this.gravity*Imagine.Time.deltaTime,b=this.dirH*this.walkSpeed*Imagine.Time.deltaTime*this.speed,c=this.dirV*Imagine.Time.deltaTime*this.speed,this.sideColl=this.collider.move(b,0),this.sideColl&&this.notify("sideColl",this.sideColl),this.coll=this.collider.move(0,c),this.coll&&this.coll.side&&(a.call(this.coll.side,"top")>=0&&(this.dirV=0,this.notify("topColl",this.coll)),a.call(this.coll.side,"bottom")>=0&&(this.dirV=0,this.notify("bottomColl",this.coll))),this.coll},jump:function(){return this.coll&&0===this.dirV&&a.call(this.coll.side,"top")>=0?this.dirV=-this.jumpPower:void 0}}}}.call(this),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};window.Player=function(){return{name:"player",dirH:0,start:function(){this.char=this.getComponent("character")},update:function(){var a,b,c;return b=this.char.element.offsetLeft,c=400-scene.offsetLeft,b>c&&scene.move(c-b,0),c>b&&scene.offsetLeft<0&&scene.move(c-b,0),a=Imagine.Input.getAxis("Horizontal"),Imagine.Input.getKey("shift")&&(a*=2),this.dirH=(this.dirH+a)/2,this.char.dirH=this.dirH,0>a&&this.char.faceLeft(),a>0&&this.char.faceRight(),Imagine.Input.getKeyDown("up")?this.char.jump():void 0},die:function(){var a;return Imagine(Announce("GAME OVER<br /><sub>(esc to restart)</sub>")),a=this.getComponent("element"),Imagine.destroy(this),Imagine(a).addComponent(Dying())},onCollision:function(b){var c;return b&&b.side&&a.call(b.side,"bottom")>=0&&(c=b.collider.getComponent("block"))?c.damage():void 0},topColl:function(a){var b;return a.collider&&(b=a.collider.getComponent("enemy"))?(b.damage(),this.char.jump()):void 0},bottomColl:function(){},sideColl:function(a){var b,c,d,e,f,g;if(a.collider&&(b=a.collider.getComponent("enemy"),b&&this.die(),a.collider.hasTag("castle"))){for(Imagine(Announce("You Win!")),g=[],d=f=1;3>=f;d=++f)c=$('<div class="firework"></div>'),$("#wrapper").append(c),Imagine(c).addComponent(Firework()),e=parseInt($(this.element).css("left")),e+=600*(Math.random()-.5),c.css("left",e),g.push(c.css("top",200*Math.random()));return g}}}}}.call(this),function(){window.Enemy=function(){return{name:"enemy",life:1,start:function(){return this.char=this.getComponent("character"),this.char.walkSpeed=.5,this.char.dirH=1},damage:function(){return this.life-=1,this.life<=0?this.die():void 0},die:function(){var a;return a=this.getComponent("element"),Imagine.destroy(this),Imagine(a).addComponent(Dying())},update:function(){}}}}.call(this),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};window.Turtle=function(){return{start:function(){return this.char=this.getComponent("character")},sideColl:function(b){return b&&(a.call(b.side,"left")>=0&&(this.char.dirH=-1,this.char.faceLeft()),a.call(b.side,"right")>=0)?(this.char.dirH=1,this.char.faceRight()):void 0}}}}.call(this),function(){window.Bowser=function(){return{start:function(){return this.char=this.getComponent("character"),this.char.jumpPower=3,this.en=this.getComponent("enemy"),this.en.life=3,this.startpos=this.element.offsetLeft,this.phase=0},update:function(){var a;switch(this.phase){case 0:if(this.char.dirH=1,a=this.element.offsetLeft-this.startpos,a>200)return this.phase=1,this.char.jump();break;case 1:if(this.char.dirH=0,0===this.char.dirV)return this.phase=2;break;case 2:if(this.char.dirH=-1,a=this.element.offsetLeft-this.startpos,0>a)return this.phase=3,this.char.jump();break;case 3:if(this.char.dirH=0,0===this.char.dirV)return this.phase=0}}}}}.call(this),function(){window.Dying=function(){return{name:"dying",dirV:-1,dirH:0,timer:3,update:function(){return this.timer-=Imagine.Time.deltaTime,this.dirV+=10*Imagine.Time.deltaTime,this.element.move(this.dirH,this.dirV),this.timer<=0?($(this.element).remove(),Imagine.destroy(this)):void 0}}}}.call(this),function(){window.Announce=function(a){return{start:function(){return $("#wrapper").append('<div class="announce">'+a+"</div>")}}}}.call(this),function(){window.Firework=function(){return{name:"firework"}}}.call(this),function(){window.FPS=function(){return{lastFPS:[],update:function(){var a,b,c,d,e;if(this.lastFPS.push(1/Imagine.Time.deltaTime),this.lastFPS.length>10){for(a=0,e=this.lastFPS,c=0,d=e.length;d>c;c++)b=e[c],a+=b;return a=Math.floor(a/this.lastFPS.length),this.lastFPS=[],$(this.element).html(a+"FPS")}}}}}.call(this),function(){$(document).ready(function(){var a,b,c,d,e;return d=function(){var a;return $("#wrapper").append('<div id="player"></div><div id="floor"></div>'),a=Imagine($("#player")[0]).addComponent(new Imagine.Collider).addComponent(Character()).addComponent(Player()).getComponent("player"),Imagine($("#floor")[0]).addComponent(new Imagine.Collider)},b=function(a,b,c){var d,e,f;switch(e="enemy"+a+"_"+b,$("#wrapper").append('<div class="enemy '+c+'" id="'+e+'"></div>'),d=$("#"+e),d.css("left",100+60*a).css("top",60*b),f=Imagine(d[0]).addComponent(new Imagine.Collider).addComponent(Character()).addComponent(Enemy()),c){case"turtle":return f.addComponent(Turtle());case"bowser":return f.addComponent(Bowser())}},a=function(a,b,c){var d,e;switch(e="autoblock"+a+"_"+b,$("#wrapper").append('<div class="'+c+'" id="'+e+'"></div>'),$("#"+e).css("left",100+60*a).css("top",60*b),d=Imagine($("#"+e)[0]).addComponent(new Imagine.Collider).addComponent(Block()).getComponent("collider"),c){case"hill":return d.ignoreSides=["left","right","bottom"];case"castle":return d.isTrigger=!0,d.addComponent(Castle()),d.addTag("castle")}},c=function(){var c,d,e,f,g;for(g=[],c=e=0,f=level1.length-1;f>=0?f>=e:e>=f;c=f>=0?++e:--e)g.push(function(){var e,f,g;for(g=[],d=e=0,f=level1[c].length-1;f>=0?f>=e:e>=f;d=f>=0?++e:--e)if(level1[c][d])switch(level1[c][d]){case 1:g.push(a(c,d,"brick"));break;case 2:g.push(b(c,d,"turtle"));break;case 3:g.push(b(c,d,"bowser"));break;case 4:g.push(a(c,d,"mbox"));break;case 5:g.push(a(c,d,"hill"));break;case 6:g.push(a(c,d,"castle"));break;default:g.push(void 0)}else g.push(void 0);return g}());return g},e=function(){var a;return a=Imagine($("#scene")[0]).addComponent({update:function(){return Imagine.Input.getKeyDown("escape")?initGame():void 0}}).getComponent("element"),a.move(-a.offsetLeft,0)},window.initGame=function(){return Imagine.engine.reset(),$("#wrapper").html(""),d(),c(),e()},initGame()})}.call(this);